<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Birthday Adventure Game</title>
<style>
/* Mobile-first styling for iPhone 12 */
body {
    margin: 0;
    padding: 0;
    font-family: "Arial", sans-serif;
    background: #d0e7f9;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

#game-container {
    width: 375px; /* iPhone 12 width */
    max-width: 95%;
    background: #ffffff;
    border-radius: 15px;
    padding: 15px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

h2 { 
    font-size: 20px;
    margin-bottom: 10px;
}

.riddle-text {
    white-space: pre-line;
    font-size: 16px;
    margin: 15px 0;
    line-height: 1.4;
}

/* Items */
.items { 
    display: flex; 
    justify-content: space-around; 
    margin-top: 15px; 
    flex-wrap: wrap; 
}
.item { 
    font-size: 40px; 
    cursor: pointer; 
    margin: 5px; 
    transition: transform 0.2s; 
}
.item:hover { transform: scale(1.15); }

#checklist { 
    font-weight: bold; 
    margin-top: 10px; 
    font-size: 16px; 
}

/* Inputs */
input[type="text"] {
    padding: 10px;
    font-size: 16px;
    width: 90%;
    border-radius: 8px;
    border: 1px solid #ccc;
    margin-top: 10px;
}

/* Buttons */
button {
    padding: 12px 20px;
    font-size: 16px;
    margin-top: 15px;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    background: #9ccbf4;
    color: #fff;
    transition: 0.2s;
}
button:hover { 
    background: #77b6f2; 
    transform: scale(1.05); 
}

/* Map Interface */
#map-container {
    position: relative;
    margin-top: 15px;
}
#map-container img {
    width: 100%;
    border-radius: 10px;
}

.map-marker {
    position: absolute;
    cursor: pointer;
    font-size: 28px;
    padding: 8px 12px;
    background: rgba(255,255,255,0.9);
    border-radius: 10px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    transform: translate(-50%, -50%);
}
.map-marker:active {
    transform: translate(-50%, -50%) scale(0.95);
}

/* Sprite */
#sprite {
    position: absolute;
    width: 60px;
    height: 60px;
    border-radius: 999px;
    border: 3px solid white;
    box-shadow: 0 0 8px rgba(0,0,0,0.4);
    left: -80px; /* offscreen */
    top: 45%;
    transition: left 1.8s ease-in-out;
}
</style>
</head>
<body>

<div id="game-container"></div>

<script>
const stages = [
    {
        id: 1,
        title: "üåÖ STAGE 1 ‚Äî Wake Up Quest",
        items: ["ü™•", "üëï", "‚åö", "üëü"],
        riddle: {
            question: `Good morning my love! Your motorbike is waiting for you.\n 
            But before you ride off‚Ä¶ the calendar has a little question for you:\n  
What age are you turning today?`,
            answer: "22"
        },
        map: {
            img: "images/singapore_map1.jpg",
            nextLocation: { top: "30%", left: "50%", label: "üèçÔ∏è Stage 2", link: "https://maps.app.goo.gl/PG8BDqgHpoAgSTm39" }
        }
    },
    {
        id: 2,
        title: "üèçÔ∏è STAGE 2 ‚Äî Motorbike Meet-Up",
        riddle: {
            question: `Some milestones are historic,\n
and some moments are just ours.\n
Can you name the first Asian country\n
that legalized love for all?`,
            answer: "Taiwan"
        },
        map: {
            img: "images/singapore_map1.jpg",
            nextLocation: { top: "35%", left: "55%", label: "üçú Stage 3", 
            link: "https://maps.app.goo.gl/AYsHQ2M9yetTexvX8" }
        }
    },
    {
        id: 3,
        title: "üçú STAGE 3 ‚Äî Brunch @ Da Xi, Plaza Sing",
        riddle: {
            question: `Where movies come alive on a silver screen,\n
and laughter echoes in the cozy cinema scene.\n
Just steps away from our brunch,\n
look for the place where stories play in frames.`,
            answer: "The Cathay"
        },
        map: {
            img: "images/singapore_map1.jpg",
            nextLocation: { top: "40%", left: "60%", label: "üé® Stage 4", 
            link: "https://maps.app.goo.gl/GRoAe8zXpuj7L2Em9" }
        }
    },
    {
        id: 4,
        title: "üé® STAGE 4 ‚Äî Pottery at CocoArt",
        riddle: {
            question: `Clay is shaped by touch‚Ä¶\n
but what gives it colour, life, and identity?\n
What‚Äôs the next magic step?`,
            answer: "Paint"
        },
        map: {
            img: "images/singapore_map1.jpg",
            nextLocation: { top: "40%", left: "60%", label: "üé® Stage 4", 
            link: "https://maps.app.goo.gl/Xj4QZ2CrkWEPWKkF6" }
        }
    },
    {
        id: 5,
        title: "üè∫ STAGE 5 ‚Äî Collect Pottery",
        riddle: {
            question: `The cups look different ‚Äî shapes, glaze, lines‚Ä¶\n
but there‚Äôs one thing they‚Äôll always share.\n
What hidden mark do both our pottery cups have?`,
            answer: "D+F"
        },
        map: {
            img: "images/singapore_map1.jpg",
            nextLocation: { top: "40%", left: "60%", label: "üé® Stage 4", 
            link: "https://maps.app.goo.gl/G874hdhyaMDjtLRK6" }
        }
    },
    {
        id: 6,
        title: "üçó STAGE 6 ‚Äî Dinner @ Bored Tacos",
        riddle: {
            question: `We‚Äôve travelled from sunlight to clay to colour.\n
Now guess the place\n
where every story we make together\n
quietly returns to rest.`,
            answer: "Binjai"
        },
        map: {
            img: "images/singapore_map1.jpg",
            nextLocation: { top: "40%", left: "60%", label: "üé® Stage 4", 
            link: "https://maps.app.goo.gl/eyCNSVBmjkgG6E8Z7" }
        }
    },
    {
        id: 7,
        title: "üéÅ STAGE 7 ‚Äî Binjai Hall Surprise Gift",
        review: true
    }
];

let currentStage = 0;
const container = document.getElementById("game-container");

/* -----------------------------
     LOAD A STAGE
------------------------------*/
function loadStage(i) {
    const stage = stages[i];
    container.innerHTML = `<h2>${stage.title}</h2>`;

    if (stage.items) {
        container.innerHTML += `
            <div class="items"></div>
            <div id="checklist">Collected: 0/${stage.items.length}</div>
        `;
        
        const itemsDiv = container.querySelector(".items");
        let collected = 0;

        stage.items.forEach(emoji => {
            const span = document.createElement("span");
            span.classList.add("item");
            span.textContent = emoji;

            span.onclick = () => {
                span.style.visibility = "hidden";
                collected++;
                document.getElementById("checklist").textContent = 
                    `Collected: ${collected}/${stage.items.length}`;

                if (collected === stage.items.length) showRiddle(stage.riddle);
            };

            itemsDiv.appendChild(span);
        });

    } else {
        showRiddle(stage.riddle);
    }
}

/* -----------------------------
     RIDDLE
------------------------------*/
function showRiddle(riddle) {
    container.innerHTML += `
        <div class="riddle-text">${riddle.question}</div>
        <input type="text" id="answer" placeholder="Your answer">
        <button onclick="checkAnswer()">Submit</button>
        <p id="feedback"></p>
    `;
}

function checkAnswer() {
    const user = document.getElementById("answer").value.trim();
    const riddle = stages[currentStage].riddle;
    const feedback = document.getElementById("feedback");

    if (user.toLowerCase() === riddle.answer.toLowerCase()) {
        feedback.textContent = "Correct! üéâ";
        showMap(stages[currentStage].map);
    } else {
        feedback.textContent = "Try again ‚ù§Ô∏è";
    }
}

/* -----------------------------
     MAP + SPRITE SLIDE
------------------------------*/

function showMap(mapData) {
    container.innerHTML = `
        <h2>Map Unlocked!</h2>
        <div id="map-container">
            <img src="${mapData.img}">
            <img id="sprite" src="images/herface.jpeg">
        </div>
        <p>Driving to the next location‚Ä¶</p>
    `;

    const sprite = document.getElementById("sprite");

    setTimeout(() => {
        sprite.style.left = mapData.nextLocation.left;
    }, 300);

    sprite.addEventListener("transitionend", () => {
        showMapMarker(mapData);
    });
}

function showMapMarker(mapData) {
    const mapContainer = document.getElementById("map-container");

    // Create marker
    const marker = document.createElement("div");
    marker.classList.add("map-marker");

    // Position
    marker.style.top = mapData.nextLocation.top;
    marker.style.left = mapData.nextLocation.left;

    // Label
    marker.textContent = mapData.nextLocation.label;

    // FIX: iOS-safe navigation
    marker.onclick = () => {
        window.location.href = mapData.nextLocation.link;
    };

    mapContainer.appendChild(marker);

    // Add next stage button *outside the map container*
    const nextButton = document.createElement("button");
    nextButton.textContent = "Go to Next Stage ‚ûú";
    nextButton.onclick = goNextStage;

    container.appendChild(nextButton);
}


function goNextStage() {
    currentStage++;
    loadStage(currentStage);
}

loadStage(currentStage);
</script>

</body>
</html>

