<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Birthday Adventure Game</title>
<style>
/* Mobile-first styling for iPhone 12 */
body {
    margin: 0;
    padding: 0;
    font-family: "Arial", sans-serif;
    background: #d0e7f9;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

#game-container {
    width: 375px; /* iPhone 12 width */
    max-width: 95%;
    background: #ffffff;
    border-radius: 15px;
    padding: 15px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

h2 { 
    font-size: 20px;
    margin-bottom: 10px;
}

.riddle-text {
    white-space: pre-line;
    font-size: 16px;
    margin: 15px 0;
    line-height: 1.4;
}

/* Items */
.items { 
    display: flex; 
    justify-content: space-around; 
    margin-top: 15px; 
    flex-wrap: wrap; 
}
.item { 
    font-size: 40px; 
    cursor: pointer; 
    margin: 5px; 
    transition: transform 0.2s; 
}
.item:hover { transform: scale(1.15); }

#checklist { 
    font-weight: bold; 
    margin-top: 10px; 
    font-size: 16px; 
}

/* Inputs */
input[type="text"] {
    padding: 10px;
    font-size: 16px;
    width: 90%;
    border-radius: 8px;
    border: 1px solid #ccc;
    margin-top: 10px;
}

/* Buttons */
button {
    padding: 12px 20px;
    font-size: 16px;
    margin-top: 15px;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    background: #9ccbf4;
    color: #fff;
    transition: 0.2s;
}
button:hover { 
    background: #77b6f2; 
    transform: scale(1.05); 
}

/* Intro Screen */
#intro-screen {
    text-align: center;
    padding: 20px;
}

#intro-screen img {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #fff;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    margin-bottom: 15px;
}

#intro-screen h1 {
    font-size: 22px;
    margin-bottom: 10px;
    color: #3d6fa5;
}

#intro-text {
    font-size: 16px;
    line-height: 1.4;
    white-space: pre-line;
    margin-bottom: 20px;
    color: #4b4b4b;
}

/* Map Interface */
#map-container {
    position: relative;
    margin-top: 15px;
}
#map-container img {
    width: 100%;
    border-radius: 10px;
}

.map-marker {
    position: absolute;
    cursor: pointer;
    font-size: 28px;
    padding: 8px 12px;
    background: rgba(255,255,255,0.9);
    border-radius: 10px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    transform: translate(-50%, -50%);
}
.map-marker:active {
    transform: translate(-50%, -50%) scale(0.95);
}

/* Sprite */
/* sprite movement */
#sprite {
    position: absolute;
    width: 28px;
    height: 28px;
    background-image: url("images/herface.jpeg");
    background-size: cover;
    background-position: center;
    border-radius: 50%;
    border: 2px solid white;
    transform: translate(-50%, -50%);
    transition: all 0.4s ease;
    z-index: 5;
}

/* map zoom animation */
.map-zoom-in {
    animation: zoomIn 1.2s ease forwards;
}

@keyframes zoomIn {
    0% { transform: scale(0.8); opacity: 0.3; }
    50% { transform: scale(1.2); opacity: 1; }
    100% { transform: scale(1); }
}

/* hotspot marker */
.hotspot {
    position: absolute;
    padding: 8px 12px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.25);
    transform: translate(-50%, -50%);
    cursor: pointer;
    font-size: 18px;
    opacity: 0;
    animation: fadeIn 0.8s ease forwards;
}

/* ENDING SCREEN */
#ending-screen {
    text-align: center;
    padding: 20px;
}

#ending-screen h1 {
    font-size: 24px;
    color: #3d6fa5;
    margin-bottom: 10px;
}

#ending-screen p {
    color: #4b4b4b;
    line-height: 1.4;
    font-size: 16px;
}

/* Star Rating */
.star-rating {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 20px 0;
}

.star {
    font-size: 34px;
    cursor: pointer;
    transition: transform 0.2s ease;
}

.star:hover {
    transform: scale(1.2);
}

.star.selected {
    transform: scale(1.25);
}

/* Review box */
#review-box {
    width: 90%;
    max-width: 300px;
    height: 90px;
    border: 2px solid #a9c9e8;
    border-radius: 10px;
    padding: 10px;
    font-size: 14px;
    outline: none;
    margin-top: 10px;
}

/* Submit button */
#submit-review {
    margin-top: 20px;
    background: #4d8fcc;
    color: white;
    padding: 12px 18px;
    border-radius: 12px;
    font-size: 16px;
    border: none;
    cursor: pointer;
}


@keyframes fadeIn {
    from { opacity: 0; transform: translate(-50%, -45%); }
    to { opacity: 1; transform: translate(-50%, -50%); }
}
</style>
</head>
<body>

<div id="game-container"></div>

<script>
const levels = [
    {
        id: 1,
        title: "üåÖ LEVEL 1: Wake Up Quest",
        items: ["üöø", "ü™•", "üëï", "‚åö", "üëü"],
        riddle: {
            question: `Your motorbike is waiting for you.\n 
But before you ride off‚Ä¶\n
The calendar has a little question for you:\n  
What age are you turning today?`,
            answer: "22"
        },
        map: {
            img: "images/level1_toBinjai.png",
            movement: {
                path: [ {x: 85, y: 50}, 
                        {x: 20, y: 40} ],
                duration: 2000
            },
            zoom: "in",
            message: "Go to your motorbike!",
            hotspot: {
                x: 50,
                y: 60,
                label: "üèçÔ∏è Motorbike",
                link: "https://maps.app.goo.gl/PG8BDqgHpoAgSTm39"
            }
        }
    },
    {
        id: 2,
        title: "üèçÔ∏è LEVEL 2: Motorbike Meet-Up",
        riddle: {
            question: `Your girlfriend just got her license, hooray,\n
She can‚Äôt wait to hit the road with you.\n
Which bike is she riding today?`,
            answer: "Kawasaki"
        },
        map: {
            img: "images/singapore_map1.jpg",
            message: "Meet her bike!",
            movement: {
                path: [
                    { x: 5,  y: 50 },
                    { x: 60, y: 54 }
                ],
                duration: 2000
            },
            hotspot: {
                x: 52,
                y: 68,
                label: "üèçÔ∏è Collect bike",
                link: "https://maps.app.goo.gl/b9oafPxLvayraaph9"
            }
        }
    },
    {
        id: 3,
        title: "üçú LEVEL 3: Brunch Time!",
        riddle: {
            question: `Some milestones are historic,\n
and some moments are just ours.\n
Can you name the first Asian country\n
that legalized love for all?`,
            answer: "Taiwan"
        },
        map: {
            img: "images/level3_toPlazaSing.png",
            message: "Ride to Plaza Singapura!",
            movement: {
                path: [
                    { x: 80,  y:10 },
                    { x: 40, y: 75 }
                ],
                duration: 2000
            },
            hotspot: {
                x: 52,
                y: 68,
                label: "üçú Plaza Sing",
                link: "https://maps.app.goo.gl/AYsHQ2M9yetTexvX8"
            }
        }
    },
    {
        id: 4,
        title: "üè∫ LEVEL 4: Our Main Activity",
        riddle: {
            question: `Where movies come alive on a silver screen,\n
and laughter echoes in the cozy cinema scene.\n
Just steps away from our brunch,\n
look for the place where stories play in frames.`,
            answer: "Cathay"
        },
        map: {
            img: "images/level4_totheCathay.png",
            message: "Walk to our main activity!",
            movement: {
                path: [
                    { x: 25,  y: 50 },
                    { x: 80, y: 60 }
                ],
                duration: 2000
            },
            hotspot: {
                x: 52,
                y: 68,
                label: "üè∫ The Cathay",
                link: "https://maps.app.goo.gl/GRoAe8zXpuj7L2Em9"
            }
        }
    },
    {
        id: 5,
        title: "üé® LEVEL 5: Finishing What We Started",
        riddle: {
            question: `Clay is shaped by touch‚Ä¶\n
but what gives it colour, life, and identity?\n
What‚Äôs the next magic step?`,
            answer: "Paint"
        },
        map: {
            img: "images/level5_toOrchardCentral.png",
            movement: {
                path: [ {x: 90, y: 50}, 
                        {x: 30, y: 40} ],
                duration: 2000
            },
            zoom: "in",
            message: "üé® We have something to collect...",
            hotspot: {
                x: 50,
                y: 60,
                label: "üé® Orchard Central",
                link: "https://maps.app.goo.gl/Xj4QZ2CrkWEPWKkF6"
            }
        }
    },
    {
        id: 6,
        title: "üåÆ LEVEL 6: D for Dinner?",
        riddle: {
            question: `The cups look different ‚Äî shapes, glaze, lines‚Ä¶\n
but there‚Äôs one thing they‚Äôll always share.\n
What hidden mark do both our pottery cups have?`,
            answer: "D+F" // accept "F+D" as alternate in code if needed
        },
        map: {
            img: "images/level6_toBoredTacos.png",
            movement: {
                path: [ {x: 10, y: 50}, 
                        {x: 87, y: 30} ],
                duration: 2000
            },
            zoom: "in",
            message: "üåÆ Dinner Time!",
            hotspot: {
                x: 50,
                y: 60,
                label: "üåÆ Dinner",
                link: "https://maps.app.goo.gl/G874hdhyaMDjtLRK6"
            }
        }
    },
    {
        id: 7,
        title: "üè† LEVEL 7: Are You Tired Yet?..",
        riddle: {
            question: `We‚Äôve travelled from sunlight to clay to colour.\n
Now guess the place\n
where every story we make together\n
quietly returns to rest.`,
            answer: "Binjai"
        },
        map: {
            img: "images/level7_toBinjai.png",
            movement: {
                path: [ {x: 80, y: 65}, 
                        {x: 20, y: 45} ],
                duration: 2000
            },
            zoom: "in",
            message: "üè† Back to home!",
            hotspot: {
                x: 50,
                y: 60,
                label: "üè† Binjai",
                link: "https://maps.app.goo.gl/eyCNSVBmjkgG6E8Z7"
            }
        }
    },
    {
      id: 8,
      title: "üéÅ LEVEL 8: Mystery Awaits",
      map: {
          img: "images/level8_Binjai.png",
          movement: {
              path: [ {x: 10, y: 50}, {x: 50, y: 50} ],
              duration: 2000
          },
          zoom: "in",
          message: "üéÅ Find the surprise!",
          hotspot: {
              x: 50,
              y: 60,
              label: "üéÅ Binjai Hall",
              link: "javascript:loadEndingScreen()"
          }
      }
  }
];

let currentStage = 0;
const container = document.getElementById("game-container");

// -------------------------
// INTRO SCREEN
// -------------------------
function loadIntro() {
    container.innerHTML = `
        <div id="intro-screen">
            <img src="images/herface.jpeg" alt="sprite">
            <h1>Good morning, birthday girl üíô</h1>
            <div id="intro-text">
You turned 22 on 22! Happy belated birthdayüéâ
But instead of a normal celebration‚Ä¶

We're doing a little adventure game.

You‚Äôll do fun activities üéØ 
Solve cute riddles üß©  
Follow the map üó∫Ô∏è  
And travel with your girlfriend ‚ù§Ô∏è

Ready to start your birthday quest?
            </div>
            <button onclick="startGame()">Start Game üéâ</button>
        </div>
    `;
}

function startGame() {
    currentStage = 0;
    loadStage(0);
}

/* -----------------------------
     LOAD A STAGE
------------------------------*/
function loadStage(i) {
    const stage = levels[i]; 
    // ALWAYS show title
    container.innerHTML = `<h2>${stage.title}</h2>`;

    if (stage.items) {
        // Instruction only for items
        const instruction = document.createElement("p");
        instruction.style.fontSize = "16px";
        instruction.style.marginBottom = "10px";
        instruction.textContent = "Complete these morning activities. Click each one only when you've done it!";
        container.appendChild(instruction);

        // Items container
        const itemsDiv = document.createElement("div");
        itemsDiv.classList.add("items");
        container.appendChild(itemsDiv);

        // Checklist
        const checklist = document.createElement("div");
        checklist.id = "checklist";
        checklist.textContent = `Collected: 0/${stage.items.length}`;
        container.appendChild(checklist);

        let collected = 0;
        stage.items.forEach(emoji => {
            const span = document.createElement("span");
            span.classList.add("item");
            span.textContent = emoji;

            span.onclick = () => {
                span.style.visibility = "hidden";
                collected++;
                checklist.textContent = `Collected: ${collected}/${stage.items.length}`;

                if (collected === stage.items.length) {
                    // ONLY replace items + checklist with riddle
                    showRiddle(stage.riddle);
                }
            };

            itemsDiv.appendChild(span);
        });

    } else if (stage.riddle) {
        showRiddle(stage.riddle);
    } else {
        loadMapStage(stage);
    }
}

/* -----------------------------
     RIDDLE
------------------------------*/
function showRiddle(riddle) {
    // KEEP the title (h2), replace everything else
    const title = container.querySelector("h2").outerHTML;

    container.innerHTML = `
        ${title}
        <div class="riddle-text">${riddle.question}</div>
        <input type="text" id="answer" placeholder="Your answer">
        <button onclick="checkAnswer()">Submit</button>
        <p id="feedback"></p>
    `;
}

function checkAnswer() {
    const user = document.getElementById("answer").value.trim();
    const riddle = levels[currentStage].riddle;
    const feedback = document.getElementById("feedback");

    if (user.toLowerCase() === riddle.answer.toLowerCase()) {
        feedback.textContent = "Correct! üéâ";

        loadMapStage(levels[currentStage]); // show map of current stage
    } else {
        feedback.textContent = "Try again ‚ù§Ô∏è";
    }
}


/* -----------------------------
     MAP + SPRITE SLIDE
------------------------------*/
loadIntro();

function loadMapStage(stage) {
    container.innerHTML = `
        <h2>üìç Location Unlocked</h2>
        <p>${stage.map.message}</p>
        <div id="map-container" style="position: relative;">
            <img id="map-img" src="${stage.map.img}" class="map-zoom-in" style="width:100%; border-radius:12px;">
            <div id="sprite"></div>
        </div>
    `;

    playMapAnimation(stage);
}

function playMapAnimation(stage) {
    const sprite = document.getElementById("sprite");

    if (!stage.map.movement) {
        // no movement ‚Üí just show hotspot at sprite position
        setTimeout(() => {
            showHotspotBelowSprite(sprite, stage.map.hotspot);
        }, 1200);
        return;
    }

    const start = stage.map.movement.path[0];
    const end = stage.map.movement.path[1];

    // Set start position
    sprite.style.left = start.x + "%";
    sprite.style.top = start.y + "%";

    // Slower movement: increase duration if needed
    const duration = stage.map.movement.duration + 1000;
    sprite.style.transition = `all ${duration}ms ease`;

    // Move sprite to end position
    setTimeout(() => {
        sprite.style.left = end.x + "%";
        sprite.style.top = end.y + "%";
    }, 100);

    // Show hotspot **after sprite finishes moving**
    setTimeout(() => {
        showHotspotBelowSprite(sprite, stage.map.hotspot);
    }, duration + 150); // slightly after transition
}

function showHotspotBelowSprite(sprite, loc) {
    const mapContainer = document.getElementById("map-container");

    const hotspot = document.createElement("div");
    hotspot.classList.add("hotspot");

    // Get sprite final position
    const spriteRect = sprite.getBoundingClientRect();
    const containerRect = mapContainer.getBoundingClientRect();

    // Calculate position relative to container
    const leftPercent = ((spriteRect.left + spriteRect.width/2 - containerRect.left) / containerRect.width) * 100;

    // Add extra offset downward (e.g., 15% of sprite height)
    const offset = 18; 
    const topPercent = ((spriteRect.top + spriteRect.height - containerRect.top) / containerRect.height) * 100 + (offset * spriteRect.height / containerRect.height);

    hotspot.style.left = `${leftPercent}%`;
    hotspot.style.top = `${topPercent}%`;
    hotspot.textContent = loc.label;

    hotspot.addEventListener("click", () => {
        window.open(loc.link, "_blank");
    });

    mapContainer.appendChild(hotspot);

    // Next button
    const nextButton = document.createElement("button");
    nextButton.textContent = "Go to Next Level ‚ûú";
    nextButton.onclick = goNextStage;
    container.appendChild(nextButton);
}

function goNextStage() {
    currentStage++;
    if (currentStage < levels.length) {
        loadStage(currentStage);
    } else {
        loadEndingScreen();
    }
}

function showHotspot(loc) {
    const mapContainer = document.getElementById("map-container");

    const hotspot = document.createElement("div");
    hotspot.classList.add("hotspot");

    // Position label below the sprite
    hotspot.style.left = loc.x + "%";
    hotspot.style.top = `calc(${loc.y}% + 20px)`; // 20px below sprite, adjust if needed
    hotspot.textContent = loc.label;

    hotspot.addEventListener("click", () => {
        window.open(loc.link, "_blank");
    });

    mapContainer.appendChild(hotspot);

    const nextButton = document.createElement("button");
    nextButton.textContent = "Go to Next Level ‚ûú";
    nextButton.onclick = goNextStage;
    container.appendChild(nextButton);
}

// ---------------------------
// ENDING + RATING + REVIEW
// ---------------------------

let selectedStars = 0;

function loadEndingScreen() {
    container.innerHTML = `
        <div id="ending-screen">
            <h1>üéâ Quest Completed!</h1>
            <p>You cleared all 7 levels.<br>
            You travelled, solved riddles, completed activities.</p>

            <p style="margin-top:15px;">Rate your birthday quest ‚≠ê</p>

            <div class="star-rating">
                ${[1,2,3,4,5].map(n => 
                    `<span class="star" data-value="${n}">‚òÖ</span>`
                ).join("")}
            </div>

            <textarea id="review-box" placeholder="Leave a sweet comment if you want kiss"></textarea><br>

            <button id="submit-review" onclick="submitReview()">Submit Review</button>
        </div>
    `;

    // star selection
    document.querySelectorAll(".star").forEach(star => {
        star.addEventListener("click", () => {
            selectedStars = star.dataset.value;

            document.querySelectorAll(".star").forEach(s => 
                s.classList.remove("selected")
            );

            for (let i = 0; i < selectedStars; i++) {
                document.querySelectorAll(".star")[i].classList.add("selected");
            }
        });
    });
}

function submitReview() {
    const comment = document.getElementById("review-box").value.trim();

    container.innerHTML = `
        <div id="ending-screen">
            <h1>üíô Thank You</h1>
            <p>Your rating: ${"‚òÖ".repeat(selectedStars)}${"‚òÜ".repeat(5 - selectedStars)}</p>
            <p style="margin-top:10px;">Your review has been recorded.</p>

            <p style="margin-top:20px; font-size:15px;">
            I hope you liked your birthday quest.<br>
            Thank you for playing, and for being my awesome girlfriend.
            </p>

            <button style="margin-top:25px;" onclick="restartGame()">Play Again?</button>
        </div>
    `;
}

function restartGame() {
    loadIntro();
}


</script>

</body>
</html>

